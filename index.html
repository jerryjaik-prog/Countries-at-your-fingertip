<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Countries at Your Finger Tip</title>
    <!-- Inter font for clean typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Tailwind CSS for utility-first styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
            position: relative;
        }

        /* --- Custom CSS for the Splash Screen Animation --- */
        .splash-screen {
            transition: opacity 2s ease-in-out, visibility 2s ease-in-out;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 100;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            background-color: #90ee90; /* Light green */
        }
        
        .fade-out {
            opacity: 0;
            visibility: hidden;
        }

        .splash-text {
            color: #ff0000;
            font-size: 3rem;
            font-weight: bold;
            animation: flicker 1.5s infinite alternate;
        }
        
        @keyframes flicker {
            0% { opacity: 1; }
            50% { opacity: 0.8; }
            100% { opacity: 1; }
        }

        /* --- General Layout and Styling --- */
        .main-screen {
            display: none;
            position: relative;
            z-index: 1;
        }
        
        .rounded-box {
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        /* Wavy animation for the developer name */
        .wavy-animation {
            animation: wavy 2s ease-in-out infinite alternate;
            text-shadow: 0 0 10px rgba(0, 255, 0, 0.8), 0 0 20px rgba(0, 255, 0, 0.6);
        }
        @keyframes wavy {
            0% {
                transform: translateY(0px) rotate(0deg);
            }
            100% {
                transform: translateY(-5px) rotate(1deg);
            }
        }
        
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none; /* IE and Edge */
            scrollbar-width: none; /* Firefox */
        }

    </style>
</head>
<body class="flex flex-col min-h-screen">
    
    <!-- Splash Screen -->
    <div id="splash-screen" class="splash-screen">
        <p class="splash-text">This Program is Designed by Jaimon Mathew</p>
    </div>
    
    <!-- Main Screen -->
    <div id="main-screen" class="main-screen p-6 md:p-10 flex flex-col items-center">
        <!-- Developer Name Animation -->
        <div class="mb-8 h-32 w-full flex items-center justify-center">
            <h2 class="wavy-animation text-green-700 font-extrabold text-2xl md:text-4xl">Developed by Jaimon Mathew</h2>
        </div>

        <h1 class="text-4xl font-bold text-red-600 mb-6 text-center">Countries at your finger tip</h1>

        <!-- Search input with magnifying glass and suggestions -->
        <div class="flex flex-col md:flex-row gap-4 w-full max-w-xl relative">
            <div class="relative w-full">
                <input type="text" id="searchInput" placeholder="Type the country name here" class="flex-grow p-4 pl-12 rounded-box border border-amber-300 bg-amber-100 focus:outline-none focus:ring-2 focus:ring-amber-500 transition-all text-gray-800 w-full">
                <div class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500">
                    <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8" />
                        <line x1="21" y1="21" x2="16.65" y2="16.65" />
                    </svg>
                </div>
                <div id="suggestions" class="absolute z-10 w-full bg-white rounded-box shadow-lg mt-2 max-h-60 overflow-y-auto no-scrollbar hidden"></div>
            </div>
            <button id="searchButton" class="bg-blue-600 text-white font-semibold py-4 px-6 rounded-box shadow-lg hover:bg-blue-700 transition-colors">Search</button>
        </div>

        <!-- Loading spinner and message container -->
        <div id="statusContainer" class="mt-8 text-center hidden">
            <div id="loadingIndicator" class="animate-spin rounded-full h-12 w-12 border-4 border-blue-500 border-t-transparent mx-auto mb-4"></div>
            <p id="statusMessage" class="text-gray-600">Fetching information...</p>
        </div>

        <!-- Results Display Area -->
        <div id="resultsContainer" class="w-full max-w-3xl mt-10">
            <!-- Results will be dynamically inserted here -->
        </div>

    </div>

    <!-- Message box for alerts with new buttons for corrections -->
    <div id="custom-alert" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 shadow-xl max-w-sm w-full mx-4 text-center">
            <p id="alertMessage" class="text-gray-800 text-lg mb-4"></p>
            <div id="button-container" class="flex justify-center gap-4">
                <!-- Buttons for abbreviation alert -->
                <button id="ok-button" onclick="hideAlert()" class="bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-200">
                    OK
                </button>
                <!-- Buttons for correction alert -->
                <button id="yes-button" class="bg-green-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-green-700 transition duration-200 hidden">
                    Yes
                </button>
                <button id="no-button" class="bg-red-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-red-700 transition duration-200 hidden">
                    No
                </button>
            </div>
        </div>
    </div>

    <script>
        // Data for autocomplete suggestions
        const allCountries = ["Afghanistan", "Albania", "Algeria", "Andorra", "Angola", "Antigua and Barbuda", "Argentina", "Armenia", "Australia", "Austria", "Azerbaijan", "Bahamas", "Bahrain", "Bangladesh", "Barbados", "Belarus", "Belgium", "Belize", "Benin", "Bhutan", "Bolivia", "Bosnia and Herzegovina", "Botswana", "Brazil", "Brunei", "Bulgaria", "Burkina Faso", "Burundi", "Cabo Verde", "Cambodia", "Cameroon", "Canada", "Central African Republic", "Chad", "Chile", "China", "Colombia", "Comoros", "Congo (Congo-Brazzaville)", "Costa Rica", "Croatia", "Cuba", "Cyprus", "Czechia (Czech Republic)", "Denmark", "Djibouti", "Dominica", "Dominican Republic", "Ecuador", "Egypt", "El Salvador", "Equatorial Guinea", "Eritrea", "Estonia", "Eswatini (formerly Swaziland)", "Ethiopia", "Fiji", "Finland", "France", "Gabon", "Gambia", "Georgia", "Germany", "Ghana", "Greece", "Grenada", "Guatemala", "Guinea", "Guinea-Bissau", "Guyana", "Haiti", "Holy See", "Honduras", "Hungary", "Iceland", "India", "Indonesia", "Iran", "Iraq", "Ireland", "Israel", "Italy", "Jamaica", "Japan", "Jordan", "Kazakhstan", "Kenya", "Kiribati", "Kuwait", "Kyrgyzstan", "Laos", "Latvia", "Lebanon", "Lesotho", "Liberia", "Libya", "Liechtenstein", "Lithuania", "Luxembourg", "Madagascar", "Malawi", "Malaysia", "Maldives", "Mali", "Malta", "Marshall Islands", "Mauritania", "Mauritius", "Mexico", "Micronesia", "Moldova", "Monaco", "Mongolia", "Montenegro", "Morocco", "Mozambique", "Myanmar (formerly Burma)", "Namibia", "Nauru", "Nepal", "Netherlands", "New Zealand", "Nicaragua", "Niger", "Nigeria", "North Korea", "North Macedonia (formerly Macedonia)", "Norway", "Oman", "Pakistan", "Palau", "Palestine State", "Panama", "Papua New Guinea", "Paraguay", "Peru", "Philippines", "Poland", "Portugal", "Qatar", "Romania", "Russia", "Rwanda", "Saint Kitts and Nevis", "Saint Lucia", "Saint Vincent and the Grenadines", "Samoa", "San Marino", "Sao Tome and Principe", "Saudi Arabia", "Senegal", "Serbia", "Seychelles", "Sierra Leone", "Singapore", "Slovakia", "Slovenia", "Solomon Islands", "Somalia", "South Africa", "South Korea", "South Sudan", "Spain", "Sri Lanka", "Sudan", "Suriname", "Sweden", "Switzerland", "Syria", "Tajikistan", "Tanzania", "Thailand", "Timor-Leste", "Togo", "Tonga", "Trinidad and Tobago", "Tunisia", "Turkey", "Turkmenistan", "Tuvalu", "Uganda", "Ukraine", "United Arab Emirates", "United Kingdom", "United States of America", "Uruguay", "Uzbekistan", "Vanuatu", "Venezuela", "Vietnam", "Yemen", "Zambia", "Zimbabwe"];

        document.addEventListener('DOMContentLoaded', () => {
            const splashScreen = document.getElementById('splash-screen');
            const mainScreen = document.getElementById('main-screen');
            const searchInput = document.getElementById('searchInput');
            const searchButton = document.getElementById('searchButton');
            const resultsContainer = document.getElementById('resultsContainer');
            const statusContainer = document.getElementById('statusContainer');
            const statusMessage = document.getElementById('statusMessage');
            const suggestionsContainer = document.getElementById('suggestions');
            
            // Get references to alert elements
            const alertBox = document.getElementById('custom-alert');
            const alertMessageElement = document.getElementById('alertMessage');
            const okButton = document.getElementById('ok-button');
            const yesButton = document.getElementById('yes-button');
            const noButton = document.getElementById('no-button');
            
            // Set splash screen to fade out faster
            setTimeout(() => {
                splashScreen.classList.add('fade-out');
                setTimeout(() => {
                    splashScreen.style.display = 'none';
                    mainScreen.style.display = 'flex';
                    document.body.style.overflowX = 'hidden';
                }, 2000); // Matches the CSS transition duration
            }, 1000); // Start fade out after 1 second

            // --- Autocomplete Logic ---
            searchInput.addEventListener('input', () => {
                const query = searchInput.value.trim().toLowerCase();
                suggestionsContainer.innerHTML = '';
                if (query.length > 1) {
                    const filteredCountries = allCountries.filter(country => 
                        country.toLowerCase().startsWith(query)
                    );
                    if (filteredCountries.length > 0) {
                        suggestionsContainer.classList.remove('hidden');
                        filteredCountries.forEach(country => {
                            const div = document.createElement('div');
                            div.textContent = country;
                            div.classList.add('p-3', 'cursor-pointer', 'hover:bg-gray-200', 'transition-colors');
                            div.addEventListener('click', () => {
                                searchInput.value = country;
                                suggestionsContainer.classList.add('hidden');
                                handleSearch();
                            });
                            suggestionsContainer.appendChild(div);
                        });
                    } else {
                        suggestionsContainer.classList.add('hidden');
                    }
                } else {
                    suggestionsContainer.classList.add('hidden');
                }
            });

            // Hide suggestions when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('#searchInput, #suggestions')) {
                    suggestionsContainer.classList.add('hidden');
                }
            });
            
            // --- Event Listeners ---
            searchButton.addEventListener('click', handleSearch);
            searchInput.addEventListener('keypress', (event) => {
                if (event.key === 'Enter') {
                    handleSearch();
                }
            });


            // --- Helper Functions ---
            /**
             * Displays a custom alert message with different button options based on the type.
             * @param {string} message The message to display.
             * @param {string} type The type of alert: 'regular', 'refresh', or 'correction'.
             * @param {string} [data] Optional data to pass, like the suggested country name for 'correction' type.
             */
            function showAlert(message, type, data = null) {
                alertMessageElement.textContent = message;
                alertBox.dataset.type = type;
                
                // Hide all buttons first
                okButton.classList.add('hidden');
                yesButton.classList.add('hidden');
                noButton.classList.add('hidden');
                
                // Show the correct buttons based on the alert type
                if (type === 'correction') {
                    yesButton.classList.remove('hidden');
                    noButton.classList.remove('hidden');
                    // Store the suggested country name on the yes button for later use
                    yesButton.dataset.suggestion = data;
                } else {
                    okButton.classList.remove('hidden');
                    // For the refresh case, store the flag on the button itself
                    if (type === 'refresh') {
                        okButton.dataset.refresh = 'true';
                    } else {
                        delete okButton.dataset.refresh;
                    }
                }

                alertBox.classList.remove('hidden');
            }

            // Function to handle the "OK" button click
            function hideAlert() {
                const type = okButton.dataset.refresh;
                alertBox.classList.add('hidden');
                if (type === 'true') {
                    location.reload();
                }
            }

            // New functions to handle the "Yes" and "No" buttons
            function confirmCorrection() {
                const suggestedCountry = yesButton.dataset.suggestion;
                alertBox.classList.add('hidden');
                if (suggestedCountry) {
                    searchInput.value = suggestedCountry;
                    handleSearch();
                }
            }

            function denyCorrection() {
                alertBox.classList.add('hidden');
                searchInput.focus(); // Focus the input field so the user can try again
            }

            // Add event listeners for the new buttons
            yesButton.addEventListener('click', confirmCorrection);
            noButton.addEventListener('click', denyCorrection);

            function showStatus(message, isLoading = true) {
                statusMessage.textContent = message;
                statusContainer.classList.remove('hidden');
                if (!isLoading) {
                    document.getElementById('loadingIndicator').classList.add('hidden');
                } else {
                    document.getElementById('loadingIndicator').classList.remove('hidden');
                }
            }
            function hideStatus() {
                statusContainer.classList.add('hidden');
            }
            function clearResults() {
                resultsContainer.innerHTML = '';
            }

            // Main search handler
            async function handleSearch() {
                const countryName = searchInput.value.trim();
                if (countryName === '') {
                    showAlert('Please type a country name.', 'regular');
                    return;
                }
                
                // Check for abbreviations (simple check)
                if (countryName.length <= 3 && countryName.toUpperCase() === countryName) {
                    // Pass `true` to the showAlert function to trigger a refresh on dismissal
                    showAlert('Please use the full country name, not an abbreviation.', 'refresh');
                    return;
                }

                clearResults();
                showStatus('Fetching data from multiple sources...');
                
                try {
                    const countryData = await fetchCountryData(countryName);
                    
                    if (countryData.length === 0) {
                        showStatus('Country not found. Trying to find a close match...', true);
                        const correction = await getCorrectionFromGemini(countryName);
                        if (correction && correction.suggestion !== 'N/A') {
                            showAlert(`Country not found. Did you mean "${correction.suggestion}"?`, 'correction', correction.suggestion);
                        } else {
                            showAlert('Country not found. Please try a different name.', 'regular');
                        }
                        hideStatus();
                        return;
                    }
                    
                    const countryInfo = countryData[0];
                    const countryCapital = countryInfo.capital?.[0] || 'N/A';
                    const countryPopulation = countryInfo.population?.toLocaleString() || 'N/A';
                    const countryArea = countryInfo.area?.toLocaleString() || 'N/A';
                    const countryLanguages = Object.values(countryInfo.languages || {}).join(', ') || 'N/A';

                    showStatus('AI is analyzing data...');
                    const llmData = await fetchGeminiData(countryName);

                    renderResults({
                        name: countryInfo.name.common,
                        capital: countryCapital,
                        population: countryPopulation,
                        area: countryArea,
                        languages: countryLanguages,
                        ...llmData
                    });

                } catch (error) {
                    console.error("Error during search:", error);
                    showAlert(`Failed to fetch information. Please try again. Error: ${error.message}`, 'regular');
                    hideStatus();
                }
            }
            
            async function getCorrectionFromGemini(query) {
                const apiKey = "AIzaSyCJ2i8V24_-ydPx8p3ryTqVjzYDiCF3gW0";
                const prompt = `Based on the potentially misspelled country name "${query}", suggest the correct full country name. If no close match is found, respond with "N/A". Respond as a JSON object with no other text, formatted as follows: {"suggestion": "Correct Name"}`;
                
                const payload = {
                    contents: [{ role: "user", parts: [{ text: prompt }] }],
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: "OBJECT",
                            properties: {
                                "suggestion": { "type": "STRING" }
                            }
                        }
                    }
                };
                
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) {
                    throw new Error(`API call for correction failed with status: ${response.status}`);
                }
                const result = await response.json();
                const textContent = result?.candidates?.[0]?.content?.parts?.[0]?.text;
                return JSON.parse(textContent);
            }


            async function fetchCountryData(countryName) {
                const url = `https://restcountries.com/v3.1/name/${encodeURIComponent(countryName)}?fullText=true`;
                const response = await fetch(url);
                if (!response.ok) {
                    if (response.status === 404) {
                        return [];
                    }
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                return data;
            }

            async function fetchGeminiData(countryName) {
                const apiKey = "AIzaSyCJ2i8V24_-ydPx8p3ryTqVjzYDiCF3gW0";
                
                const prompt = `For the country "${countryName}", provide the following information as a JSON object with no other text or formatting:
                1. The name of the current President or Prime Minister.
                2. The number of states or equivalent administrative divisions.
                3. The distance from New Delhi, India in kilometers.
                4. The main festivals celebrated.
                5. The approximate religious composition of the population in percentages.
                6. A more detailed history of the country (4-5 sentences).
                7. The local currency name and its approximate current exchange rate compared to USD, EUR, and INR. Provide a clear, comma-separated string for this.
                8. The primary colors of the national flag (e.g., "Red, White, Blue").

                If any information is not available, use "N/A".
                Example format:
                {
                    "leader": "Name of Leader",
                    "states": "Number of states",
                    "distance_from_india_km": "Distance in km",
                    "festivals": "Festival 1, Festival 2, ...",
                    "religious_composition": "Religion 1: %, Religion 2: %",
                    "history": "Detailed history...",
                    "currency_exchange": "Currency: Name, 1 USD = X Local, 1 EUR = Y Local, 1 INR = Z Local",
                    "flag_colors": "Color 1, Color 2, ..."
                }`;
                
                const payload = {
                    contents: [{ role: "user", parts: [{ text: prompt }] }],
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: "OBJECT",
                            properties: {
                                "leader": { "type": "STRING" },
                                "states": { "type": "STRING" },
                                "distance_from_india_km": { "type": "STRING" },
                                "festivals": { "type": "STRING" },
                                "religious_composition": { "type": "STRING" },
                                "history": { "type": "STRING" },
                                "currency_exchange": { "type": "STRING" },
                                "flag_colors": { "type": "STRING" }
                            }
                        }
                    }
                };
                
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) {
                    throw new Error(`API call failed with status: ${response.status}`);
                }

                const result = await response.json();
                const textContent = result?.candidates?.[0]?.content?.parts?.[0]?.text;
                if (!textContent) {
                    throw new Error('No content received from the AI.');
                }
                
                return JSON.parse(textContent);
            }

            // Renders the final results on the page
            function renderResults(data) {
                hideStatus();
                // Dynamically set background colors based on flag colors
                const flagColors = data.flag_colors.split(',').map(c => c.trim().toLowerCase());
                const colorMap = {
                    'red': 'bg-red-200', 'white': 'bg-gray-200', 'blue': 'bg-blue-200', 'green': 'bg-green-200',
                    'yellow': 'bg-yellow-200', 'black': 'bg-gray-800 text-white', 'orange': 'bg-orange-200',
                    'pink': 'bg-pink-200', 'purple': 'bg-purple-200', 'brown': 'bg-amber-800'
                };
                
                const containerBgColor = colorMap[flagColors[0]] || 'bg-white';
                
                resultsContainer.innerHTML = `
                    <div class="${containerBgColor} p-8 rounded-box shadow-xl mb-8">
                        <h2 class="text-3xl font-bold text-gray-800 mb-4">${data.name}</h2>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <div class="bg-red-100 p-4 rounded-lg">
                                <p class="text-sm text-gray-500 font-medium">Capital City</p>
                                <p class="text-lg font-semibold text-gray-700">${data.capital}</p>
                            </div>
                            <div class="bg-green-100 p-4 rounded-lg">
                                <p class="text-sm text-gray-500 font-medium">Population</p>
                                <p class="text-lg font-semibold text-gray-700">${data.population}</p>
                            </div>
                            <div class="bg-pink-100 p-4 rounded-lg">
                                <p class="text-sm text-gray-500 font-medium">Total Area (sq km)</p>
                                <p class="text-lg font-semibold text-gray-700">${data.area}</p>
                            </div>
                            <div class="bg-blue-100 p-4 rounded-lg">
                                <p class="text-sm text-gray-500 font-medium">Languages</p>
                                <p class="text-lg font-semibold text-gray-700">${data.languages}</p>
                            </div>
                            <div class="bg-yellow-100 p-4 rounded-lg">
                                <p class="text-sm text-gray-500 font-medium">Current Leader</p>
                                <p class="text-lg font-semibold text-gray-700">${data.leader}</p>
                            </div>
                            <div class="bg-yellow-200 p-4 rounded-lg">
                                <p class="text-sm text-gray-500 font-medium">Number of States</p>
                                <p class="text-lg font-semibold text-gray-700">${data.states}</p>
                            </div>
                            <div class="bg-red-400 p-4 rounded-lg">
                                <p class="text-sm text-gray-500 font-medium">Distance from India</p>
                                <p class="text-lg font-semibold text-white">${data.distance_from_india_km} km</p>
                            </div>
                            <div class="bg-pink-100 p-4 rounded-lg col-span-1 md:col-span-2 lg:col-span-1">
                                <p class="text-sm text-gray-500 font-medium">Religious Composition</p>
                                <p class="text-lg font-semibold text-gray-700">${data.religious_composition}</p>
                            </div>
                            <div class="bg-emerald-200 p-4 rounded-lg col-span-1 md:col-span-2">
                                <p class="text-sm text-gray-500 font-medium">Main Festivals</p>
                                <p class="text-lg font-semibold text-gray-700">${data.festivals}</p>
                            </div>
                            <div class="bg-gray-100 p-4 rounded-lg col-span-full">
                                <p class="text-sm text-gray-500 font-medium">Currency Exchange</p>
                                <p class="text-lg font-semibold text-gray-700">${data.currency_exchange}</p>
                            </div>
                        </div>
                        
                        <div class="bg-sky-200 p-4 rounded-lg mt-6">
                            <p class="text-sm text-gray-500 font-medium">Brief History</p>
                            <p class="text-lg text-gray-700 leading-relaxed">${data.history}</p>
                        </div>
                    </div>
                `;
            }
        });
    </script>
</body>
</html>
